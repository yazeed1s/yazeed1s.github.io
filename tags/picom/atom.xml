<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>Yazeed&#x27;s Blog - Picom</title>
    <subtitle>Notes on systems and low-level software.</subtitle>
    <link rel="self" type="application/atom+xml" href="https://yazeed1s.github.io/tags/picom/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://yazeed1s.github.io"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2025-12-12T00:00:00+00:00</updated>
    <id>https://yazeed1s.github.io/tags/picom/atom.xml</id>
    <entry xml:lang="en">
        <title>My monitor was dying</title>
        <published>2025-12-12T00:00:00+00:00</published>
        <updated>2025-12-12T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://yazeed1s.github.io/posts/my-monitor-was-dying/"/>
        <id>https://yazeed1s.github.io/posts/my-monitor-was-dying/</id>
        
        <content type="html" xml:base="https://yazeed1s.github.io/posts/my-monitor-was-dying/">&lt;p&gt;I got a new Dell monitor and a few days in I noticed a dim shadow in the top-left corner. It looked physical. Like backlight bleed or panel uniformity issues. Like I bought a defective unit.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;blaming-hardware-first&quot;&gt;blaming hardware first&lt;&#x2F;h2&gt;
&lt;p&gt;When you see corner darkening you think hardware. Did I twist the panel when mounting it? Bad cable? Backlight issue? I ran the usual checks. Built-in diagnostics were clean. Different cables didn&#x27;t help. The shadow just sat there looking like it belonged to the panel.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-wayland-test&quot;&gt;the wayland test&lt;&#x2F;h2&gt;
&lt;p&gt;I was about to start an RMA process when I thought I should at least try a different display stack. Logged into a Wayland session. Same laptop, same cable, same monitor.&lt;&#x2F;p&gt;
&lt;p&gt;Shadow gone.&lt;&#x2F;p&gt;
&lt;p&gt;So the monitor was fine. This had to be something in my X11 setup.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-changed&quot;&gt;what changed&lt;&#x2F;h2&gt;
&lt;p&gt;I tried to think about what was different. I had updated ZWM (my window manager) a few days ago, right around when this started. Everything else was the same: same picom config, same polybar, same everything.&lt;&#x2F;p&gt;
&lt;p&gt;Quick test: when I rolled back the ZWM changes the shadow disappeared, and when I restored them the shadow came back.&lt;&#x2F;p&gt;
&lt;p&gt;So I broke something.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;finding-the-actual-cause&quot;&gt;finding the actual cause&lt;&#x2F;h2&gt;
&lt;p&gt;I started killing things to narrow it down. Disabled shadows in picom. Artifact gone. So it&#x27;s definitely a shadow from some window.&lt;&#x2F;p&gt;
&lt;p&gt;Re-enabled shadows and started killing windows one by one. When I killed polybar the shadow disappeared instantly.&lt;&#x2F;p&gt;
&lt;p&gt;Polybar was the source. But polybar was on my laptop screen, not on the external monitor. I wasn&#x27;t even looking at my laptop.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-i-actually-changed-in-zwm&quot;&gt;what I actually changed in ZWM&lt;&#x2F;h2&gt;
&lt;p&gt;My WM update reimplemented the stacking order logic. The old code was a mess so I rewrote it to properly follow EWMH, which specifies that window types should stack in a particular order. &lt;code&gt;_NET_WM_TYPE_DOCK&lt;&#x2F;code&gt; windows (like polybar) are supposed to sit above most other windows.&lt;&#x2F;p&gt;
&lt;p&gt;Before my fix, polybar wasn&#x27;t stacked as high as the spec says it should be. After my fix, it was. And since picom draws shadows on windows, polybar&#x27;s shadow was now rendering on top of other windows instead of under them.&lt;&#x2F;p&gt;
&lt;p&gt;When Firefox or any bright window was near that corner of the screen, the shadow overlay looked exactly like panel dimming.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;why-the-shadow-crossed-monitors&quot;&gt;why the shadow crossed monitors&lt;&#x2F;h2&gt;
&lt;p&gt;X11 treats the entire desktop as one big coordinate space. Monitors are just rectangles positioned within it:&lt;&#x2F;p&gt;
&lt;pre class=&quot;giallo&quot; style=&quot;color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);&quot;&gt;&lt;code data-lang=&quot;shellscript&quot;&gt;&lt;span class=&quot;giallo-l&quot;&gt;&lt;span style=&quot;color: light-dark(#3C6362, #A2BD90);&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt; xrandr&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#784367, #CA9D7D);&quot;&gt; -&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#784367, #CA9D7D);&quot;&gt;-listmonitors&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;giallo-l&quot;&gt;&lt;span style=&quot;color: light-dark(#3C6362, #A2BD90);&quot;&gt;Monitors:&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#784367, #CA9D7D);&quot;&gt; 2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;giallo-l&quot;&gt;&lt;span style=&quot;color: light-dark(#3C6362, #A2BD90);&quot;&gt; 0:&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt; +&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#7D4242, #D4D4C0);&quot;&gt;*&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt;eDP&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt; 1920&#x2F;302x1200&#x2F;189+0+0&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt;  eDP&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;span class=&quot;giallo-l&quot;&gt;&lt;span style=&quot;color: light-dark(#3C6362, #A2BD90);&quot;&gt; 1:&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt; +DisplayPort-0&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt; 2560&#x2F;597x1440&#x2F;336+1920+0&lt;&#x2F;span&gt;&lt;span style=&quot;color: light-dark(#4A6934, #CB8B8B);&quot;&gt;  DisplayPort-0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;My laptop screen is at x=0. The external monitor starts at x=1920.&lt;&#x2F;p&gt;
&lt;p&gt;Polybar sits at the top of the laptop screen. Its shadow extends past its bounds. If that extension reaches x=1920, it bleeds into the top-left corner of the external monitor.&lt;&#x2F;p&gt;
&lt;p&gt;Shadows and blur effects don&#x27;t know about monitor boundaries. They just work in global pixel coordinates. That&#x27;s where my &quot;hardware defect&quot; was.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;fix&quot;&gt;fix&lt;&#x2F;h2&gt;
&lt;p&gt;Added polybar to picom&#x27;s shadow exclusion list. Shadow gone. Problem never came back.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;takeaway&quot;&gt;takeaway&lt;&#x2F;h2&gt;
&lt;p&gt;The monitor was fine the whole time. I almost returned working hardware because of a software shadow.&lt;&#x2F;p&gt;
&lt;p&gt;Isolating layers is faster than spiraling through hardware returns. The Wayland test took 30 seconds and told me everything I needed to know. Also learned that X11 multi-monitor is one big canvas and compositor effects don&#x27;t stop at monitor boundaries unless you explicitly make them.&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
