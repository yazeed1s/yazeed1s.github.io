<!doctype html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="What context switches are, why we need them, and what they cost." />
<meta
    name="keywords"
    content="yazeed, blog, alharthi, yaz, yazeed1s"
/>
<link rel="canonical" href="https://yazeed1s.github.io/posts/context-switches/" />

<title>Context Switches | Yazeed&#x27;s Blog</title>
<meta property="og:site_name" content="Yazeed&#x27;s Blog" />
<meta property="og:title" content="Context Switches | Yazeed&#x27;s Blog" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://yazeed1s.github.io/posts/context-switches/" />
<meta property="og:description" content="What context switches are, why we need them, and what they cost." />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Context Switches" />
<meta name="twitter:description" content="What context switches are, why we need them, and what they cost." />

    <link rel="icon" href="&#x2F;favicon.ico" />
    
    <link rel="stylesheet" href="https://yazeed1s.github.io/font.css" />
    <link rel="stylesheet" href="https://yazeed1s.github.io/css/base.css" />

           
    
    
    

          
    
    
    
    <style>
        :root {
            --nav-basis: 25%;
            --light-bg: #eae6deff;
            --light-text: #1a1410;
            --light-text-muted: #1a1410;
            --light-accent: #9E4440;
            --light-accent-hover: #7A3533;
            --light-code-bg: #e1ded6ff;
            --light-border: #abaaaaff;
            --light-bold: #1a1410;
            --light-italic: #1a1410;
            --light-headers: #1a1410;
            --dark-bg: #303132;
            --dark-text: #bebbb9ff;
            --dark-text-muted: #d5d2cf;
            --dark-accent: #e57665;
            --dark-accent-hover: #888885;
            --dark-code-bg: #282829;
            --dark-border: #524f4c;
            --dark-bold: #d5d2cf;
            --dark-italic: #d5d2cf;
            --dark-headers: #d5d2cf;
        }
    </style>
    <meta name="theme-color" id="tc" />
    <script>
        (function () {
            var m = matchMedia("(prefers-color-scheme:dark)"),
                t = localStorage.theme || (m.matches ? "dark" : "light"),
                h = document.documentElement,
                c = document.getElementById("tc");
            h.className = t;
            function u() {
                c.content = getComputedStyle(h).getPropertyValue("--tc");
            }
            u();
            window.T = function () {
                t = t === "dark" ? "light" : "dark";
                localStorage.theme = t;
                h.className = t;
                u();
            };
        })();
    </script>
    
</head>

<body>
    <a href="#main" class="skip-link">Skip to content</a>
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><symbol id="light" viewBox="0 0 32 32"><rect x="15" y="2" width="2" height="5"/><rect x="21.6675" y="6.8536" width="4.958" height="1.9998" transform="translate(1.5191 19.3744) rotate(-45)"/><rect x="25" y="15" width="5" height="2"/><rect x="23.1466" y="21.6675" width="1.9998" height="4.958" transform="translate(-10.0018 24.1465) rotate(-45)"/><rect x="15" y="25" width="2" height="5"/><rect x="5.3745" y="23.1466" width="4.958" height="1.9998" transform="translate(-14.7739 12.6256) rotate(-45)"/><rect x="2" y="15" width="5" height="2"/><rect x="6.8536" y="5.3745" width="1.9998" height="4.958" transform="translate(-3.253 7.8535) rotate(-45)"/><path d="M16,12a4,4,0,1,1-4,4,4.0045,4.0045,0,0,1,4-4m0-2a6,6,0,1,0,6,6,6,6,0,0,0-6-6Z"/></symbol>
<symbol id="asleep" viewBox="0 0 32 32"><path d="M13.5025,5.4136A15.0755,15.0755,0,0,0,25.096,23.6082a11.1134,11.1134,0,0,1-7.9749,3.3893c-.1385,0-.2782.0051-.4178,0A11.0944,11.0944,0,0,1,13.5025,5.4136M14.98,3a1.0024,1.0024,0,0,0-.1746.0156A13.0959,13.0959,0,0,0,16.63,28.9973c.1641.006.3282,0,.4909,0a13.0724,13.0724,0,0,0,10.702-5.5556,1.0094,1.0094,0,0,0-.7833-1.5644A13.08,13.08,0,0,1,15.8892,4.38,1.0149,1.0149,0,0,0,14.98,3Z"/></symbol>
<symbol id="rss" viewBox="0 0 32 32"><path d="M8,18c-3.3,0-6,2.7-6,6s2.7,6,6,6s6-2.7,6-6C14,20.7,11.3,18,8,18z M8,28c-2.2,0-4-1.8-4-4s1.8-4,4-4s4,1.8,4,4C12,26.2,10.2,28,8,28z"/><path d="M30,24h-2C28,13,19,4,8,4V2C20.1,2,30,11.9,30,24z"/><path d="M22,24h-2c0-6.6-5.4-12-12-12v-2C15.7,10,22,16.3,22,24z"/></symbol>
</svg>

    <header id="site-header">
        <div>
            <span class="header-brand"><a href="https://yazeed1s.github.io"><strong><span style="color: var(--accent-hover);">~/</span>Yazeed&#x27;s Blog</strong></a></span>
            <nav>
                <a href="https://yazeed1s.github.io/" >Home</a>
                <a href="https://yazeed1s.github.io/posts/"  class="active" >Posts</a>
                <a href="https://yazeed1s.github.io/projects/" >Projects</a>
                <a href="https://yazeed1s.github.io/tags/" >Tags</a>
                </nav>
            <a href="#" onclick="
                        T();
                        return false;
                    " class="theme" aria-label="Toggle theme" title="Toggle theme">
<svg><use href="#light"/></svg>
<svg><use href="#asleep"/></svg></a>
        </div>
    </header>
    <hr class="site-sep" />
    <main id="main">
<article>
    <header>
        <h1>Context Switches</h1>
        <div class="post-meta">
            <time datetime="2025-12-01">01 Dec 2025</time>
            
            <span>What context switches are, why we need them, and what they cost.</span>
             
            <span class="post-tags">
                <span class="post-tags-label">Tags: </span>
                
                <a href="https://yazeed1s.github.io/tags/os">OS</a><span
                    class="tag-comma">,</span> 
                <a href="https://yazeed1s.github.io/tags/cpu">CPU</a><span
                    class="tag-comma">,</span> 
                <a href="https://yazeed1s.github.io/tags/scheduling">Scheduling</a>
            </span>
            
        </div>
    </header>
     <p>I wanted to write down what I understand about context switches because they keep coming up when I read about performance and scheduling.</p>
<h2 id="what-is-a-context-switch">what is a context switch</h2>
<p>A context switch is when the CPU stops running one process (or thread) and starts running another. The OS has to save everything about the current process so it can resume it later, then load everything about the next process so it can start running.</p>
<p>"Everything" here means: the program counter (where the process was in its code), the register values, the stack pointer, and some other CPU state. This is called the process context.</p>
<p>The reason we need this is simple: we have more processes than CPUs. On my laptop I might have hundreds of processes but only 8 cores. They all need to run somehow, so they take turns. The OS gives each process a slice of time on a CPU, and when the slice is up (or something else happens), it switches to another process.</p>
<h2 id="when-do-context-switches-happen">when do context switches happen</h2>
<p>A few situations:</p>
<p><strong>Timer interrupt.</strong> The scheduler sets a timer (maybe 1-10ms depending on the OS and config). When it fires, the kernel gets control and can decide to switch to another process. This is called preemption.</p>
<p><strong>Process blocks.</strong> If a process does something that has to wait (reading from disk, waiting for network, waiting for a lock), it makes no sense to keep it on the CPU. The kernel switches to something that can actually run.</p>
<p><strong>Explicit yield.</strong> A process can voluntarily give up the CPU. This is rare in practice, most of the time the kernel just preempts.</p>
<p><strong>Higher priority process wakes up.</strong> If something more important becomes runnable (like a real-time task or an interactive process that was waiting for input), the kernel might preempt the current process immediately.</p>
<h2 id="what-actually-happens-during-a-switch">what actually happens during a switch</h2>
<p>When the kernel decides to switch from process A to process B:</p>
<ol>
<li>Save A's registers to memory (usually in some kernel data structure associated with A, like the task_struct in Linux)</li>
<li>Save A's stack pointer</li>
<li>Update page tables or TLB if the processes have different address spaces (this is where it gets expensive)</li>
<li>Load B's registers from memory</li>
<li>Load B's stack pointer</li>
<li>Jump to wherever B left off</li>
</ol>
<p>If A and B are threads in the same process, step 3 is simpler because they share the same address space. This is one reason thread switches are cheaper than process switches.</p>
<h2 id="why-context-switches-are-expensive">why context switches are expensive</h2>
<p>The direct cost isn't that bad. Saving and restoring registers takes maybe hundreds of nanoseconds to a few microseconds. The bigger costs are indirect:</p>
<p><strong>TLB flush.</strong> The TLB caches virtual-to-physical address translations. If you switch to a process with a different address space, those cached translations are useless (or worse, wrong). The TLB gets flushed and the new process starts cold. Every memory access causes a TLB miss until the cache warms up again.</p>
<p><strong>Cache pollution.</strong> The new process touches different memory. The L1/L2/L3 caches fill up with its data, evicting the old process's data. When you switch back, you start with cold caches again.</p>
<p><strong>Pipeline flush.</strong> Modern CPUs have deep pipelines with speculative execution. A context switch might flush all of that.</p>
<p>So the direct cost is maybe 1-10 microseconds depending on the hardware. But the indirect costs from cache/TLB warming can add hundreds of microseconds or more to the next stretch of execution.</p>
<h2 id="why-this-matters">why this matters</h2>
<p>If you're doing I/O-bound work, context switches are probably fine. You're waiting on disk or network anyway, the overhead is noise compared to the wait time.</p>
<p>If you're doing CPU-bound work and switching a lot, you're wasting cycles. This is why things like busy-waiting or spinning on a lock can sometimes outperform blocking (at least for short waits). You avoid the context switch overhead.</p>
<p>It's also why async I/O and event loops (like epoll, io_uring, kqueue) are popular. Instead of blocking and switching, you check if something is ready and move on. You stay on the CPU. Fewer switches, warmer caches.</p>
<h2 id="some-numbers">some numbers</h2>
<p>These are rough and depend heavily on hardware and workload:</p>
<ul>
<li>Direct context switch cost: ~1-5 μs on modern hardware</li>
<li>TLB flush + warmup: can add 10-100+ μs depending on working set size</li>
<li>Thread switch (same process): cheaper, maybe 0.5-2 μs since no page table switch</li>
<li>Typical scheduler timeslice: 1-10 ms</li>
</ul>
<p>The kernel tries to be smart about this. Linux's CFS scheduler considers cache locality when picking where to run a task. It tries to keep tasks on the same CPU they ran on last time (CPU affinity) to preserve cache warmth.</p>
<h2 id="notes">notes</h2>
<ul>
<li>You can measure context switches on Linux with <code>perf stat -e context-switches ./your_program</code> or by reading <code>/proc/[pid]/status</code></li>
<li><code>vmstat 1</code> shows system-wide context switches per second</li>
<li>Voluntary vs involuntary: voluntary means the process blocked or yielded, involuntary means the scheduler preempted it</li>
<li>In user-space threading (green threads, goroutines), "context switches" are much cheaper because you're not going through the kernel and not touching page tables</li>
</ul>
  
</article>
</main>
    <hr class="site-sep bottom-sep" />
    <footer class="s">
        
    </footer>
    

    <script>
        document.querySelectorAll("article img[srcset]").forEach((i) => {
            if (i.closest("a")) return;
            i.style.cursor = "pointer";
            i.onclick = () => {
                let d = document.createElement("div"),
                    s = i.srcset.split(",").pop().trim().split(" ")[0];
                d.className = "lb";
                d.innerHTML = '<img src="' + s + '">';
                document.body.style.overflow = "hidden";
                d.onclick = () => {
                    d.remove();
                    document.body.style.overflow = "";
                };
                document.body.appendChild(d);
            };
        });
    </script>
    
<button id="scroll-to-top" aria-label="Scroll to top" title="Scroll to top">↑</button>
<script>
    (function() {
        var btn = document.getElementById("scroll-to-top");
        if (btn) {
            window.addEventListener("scroll", function() {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                    btn.classList.add("show");
                } else {
                    btn.classList.remove("show");
                }
            });
            btn.addEventListener("click", function() {
                window.scrollTo({top: 0, behavior: 'smooth'});
            });
        }
    })();
</script>
</body>

</html>