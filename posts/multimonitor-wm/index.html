<!doctype html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="How ZWM handles multiple monitors: linked list of monitors, per-monitor desktops, and hotplug." />
<meta
    name="keywords"
    content="yazeed, blog, alharthi, yaz, yazeed1s"
/>
<link rel="canonical" href="https://yazeed1s.github.io/posts/multimonitor-wm/" />

<title>Multi-Monitor Support in a Tiling WM | Yazeed&#x27;s Blog</title>
<meta property="og:site_name" content="Yazeed&#x27;s Blog" />
<meta property="og:title" content="Multi-Monitor Support in a Tiling WM | Yazeed&#x27;s Blog" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://yazeed1s.github.io/posts/multimonitor-wm/" />
<meta property="og:description" content="How ZWM handles multiple monitors: linked list of monitors, per-monitor desktops, and hotplug." />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Multi-Monitor Support in a Tiling WM" />
<meta name="twitter:description" content="How ZWM handles multiple monitors: linked list of monitors, per-monitor desktops, and hotplug." />

    <link rel="icon" href="&#x2F;favicon.ico" />
    
    <link rel="stylesheet" href="https://yazeed1s.github.io/font.css" />
    <link rel="stylesheet" href="https://yazeed1s.github.io/css/base.css" />

           
    
    
    

          
    
    
    
    <style>
        :root {
            --nav-basis: 25%;
            --light-bg: #eae6deff;
            --light-text: #1a1410;
            --light-text-muted: #1a1410;
            --light-accent: #9E4440;
            --light-accent-hover: #7A3533;
            --light-code-bg: #e1ded6ff;
            --light-border: #abaaaaff;
            --light-bold: #1a1410;
            --light-italic: #1a1410;
            --light-headers: #1a1410;
            --dark-bg: #303132;
            --dark-text: #bebbb9ff;
            --dark-text-muted: #d5d2cf;
            --dark-accent: #e57665;
            --dark-accent-hover: #888885;
            --dark-code-bg: #282829;
            --dark-border: #524f4c;
            --dark-bold: #d5d2cf;
            --dark-italic: #d5d2cf;
            --dark-headers: #d5d2cf;
        }
    </style>
    <meta name="theme-color" id="tc" />
    <script>
        (function () {
            var m = matchMedia("(prefers-color-scheme:dark)"),
                t = localStorage.theme || (m.matches ? "dark" : "light"),
                h = document.documentElement,
                c = document.getElementById("tc");
            h.className = t;
            function u() {
                c.content = getComputedStyle(h).getPropertyValue("--tc");
            }
            u();
            window.T = function () {
                t = t === "dark" ? "light" : "dark";
                localStorage.theme = t;
                h.className = t;
                u();
            };
        })();
    </script>
    
</head>

<body>
    <a href="#main" class="skip-link">Skip to content</a>
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><symbol id="light" viewBox="0 0 32 32"><rect x="15" y="2" width="2" height="5"/><rect x="21.6675" y="6.8536" width="4.958" height="1.9998" transform="translate(1.5191 19.3744) rotate(-45)"/><rect x="25" y="15" width="5" height="2"/><rect x="23.1466" y="21.6675" width="1.9998" height="4.958" transform="translate(-10.0018 24.1465) rotate(-45)"/><rect x="15" y="25" width="2" height="5"/><rect x="5.3745" y="23.1466" width="4.958" height="1.9998" transform="translate(-14.7739 12.6256) rotate(-45)"/><rect x="2" y="15" width="5" height="2"/><rect x="6.8536" y="5.3745" width="1.9998" height="4.958" transform="translate(-3.253 7.8535) rotate(-45)"/><path d="M16,12a4,4,0,1,1-4,4,4.0045,4.0045,0,0,1,4-4m0-2a6,6,0,1,0,6,6,6,6,0,0,0-6-6Z"/></symbol>
<symbol id="asleep" viewBox="0 0 32 32"><path d="M13.5025,5.4136A15.0755,15.0755,0,0,0,25.096,23.6082a11.1134,11.1134,0,0,1-7.9749,3.3893c-.1385,0-.2782.0051-.4178,0A11.0944,11.0944,0,0,1,13.5025,5.4136M14.98,3a1.0024,1.0024,0,0,0-.1746.0156A13.0959,13.0959,0,0,0,16.63,28.9973c.1641.006.3282,0,.4909,0a13.0724,13.0724,0,0,0,10.702-5.5556,1.0094,1.0094,0,0,0-.7833-1.5644A13.08,13.08,0,0,1,15.8892,4.38,1.0149,1.0149,0,0,0,14.98,3Z"/></symbol>
<symbol id="rss" viewBox="0 0 32 32"><path d="M8,18c-3.3,0-6,2.7-6,6s2.7,6,6,6s6-2.7,6-6C14,20.7,11.3,18,8,18z M8,28c-2.2,0-4-1.8-4-4s1.8-4,4-4s4,1.8,4,4C12,26.2,10.2,28,8,28z"/><path d="M30,24h-2C28,13,19,4,8,4V2C20.1,2,30,11.9,30,24z"/><path d="M22,24h-2c0-6.6-5.4-12-12-12v-2C15.7,10,22,16.3,22,24z"/></symbol>
</svg>

    <header id="site-header">
        <div>
            <span class="header-brand"><a href="https://yazeed1s.github.io"><strong><span style="color: var(--accent-hover);">~/</span>Yazeed&#x27;s Blog</strong></a></span>
            <nav>
                <a href="https://yazeed1s.github.io/" >Home</a>
                <a href="https://yazeed1s.github.io/posts/"  class="active" >Posts</a>
                <a href="https://yazeed1s.github.io/projects/" >Projects</a>
                <a href="https://yazeed1s.github.io/tags/" >Tags</a>
                </nav>
            <a href="#" onclick="
                        T();
                        return false;
                    " class="theme" aria-label="Toggle theme" title="Toggle theme">
<svg><use href="#light"/></svg>
<svg><use href="#asleep"/></svg></a>
        </div>
    </header>
    <hr class="site-sep" />
    <main id="main">
<article>
    <header>
        <h1>Multi-Monitor Support in a Tiling WM</h1>
        <div class="post-meta">
            <time datetime="2024-09-01">01 Sep 2024</time>
            
            <span>How ZWM handles multiple monitors: linked list of monitors, per-monitor desktops, and hotplug.</span>
             
            <span class="post-tags">
                <span class="post-tags-label">Tags: </span>
                
                <a href="https://yazeed1s.github.io/tags/linux">linux</a><span
                    class="tag-comma">,</span> 
                <a href="https://yazeed1s.github.io/tags/x11">x11</a><span
                    class="tag-comma">,</span> 
                <a href="https://yazeed1s.github.io/tags/window-manager">window manager</a>
            </span>
            
        </div>
    </header>
     <p>I figured I should write down how multi-monitor actually works in ZWM.</p>
<p>The core idea is that each monitor is independent: it has its own desktops, its own focused window, and its own layout state. When you switch desktops, you switch on that monitor only, and when you tile windows, you tile within that monitor's usable area.</p>
<h2 id="the-data-model">the data model</h2>
<p>Monitors are a linked list, and each monitor holds an array of desktops, a pointer to the currently focused desktop, physical dimensions from RandR, padding for bars, and some identity info:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">struct</span><span style="color: light-dark(#855959, #A6BCAD);"> monitor_t</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    desktop_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);">         *</span><span style="color: light-dark(#4B4B48, #CB8B8B);">*</span><span>desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">   //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> array of desktops</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    desktop_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);">          *</span><span>desk</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">       //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> currently focused desktop</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    monitor_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);">          *</span><span>next</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">       //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> next monitor in list</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    rectangle_t</span><span>         rectangle</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">  //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> physical dimensions</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    padding_t</span><span>           padding</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">    //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> strut padding (for bars)</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    xcb_randr_output_t</span><span>  randr_id</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">    uint32_t</span><span>            id</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">    bool</span><span>                is_focused</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">    bool</span><span>                is_primary</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">    //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> ...</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span></code></pre>
<p>Three global pointers track state:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">monitor_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>head_monitor </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> NULL</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">  //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> start of linked list</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">monitor_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>curr_monitor </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> NULL</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">  //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> currently active monitor</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">monitor_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>prim_monitor </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> NULL</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">  //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> primary monitor (usually where bar lives)</span></span></code></pre>
<p>Most operations use <code>curr_monitor</code>. When you spawn a window, it goes to <code>curr_monitor-&gt;desk</code>, and when you switch desktops, you're switching <code>curr_monitor-&gt;desktops[n]</code>.</p>
<h2 id="detecting-monitors-at-startup">detecting monitors at startup</h2>
<p>At startup, ZWM checks what's available:</p>
<ol>
<li>RandR if present (preferred)</li>
<li>Xinerama if RandR isn't there</li>
<li>Fallback to the whole screen as one monitor</li>
</ol>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span>query_xr </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> xcb_get_extension_data</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>wm</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">connection</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> &amp;</span><span style="color: light-dark(#7D4242, #D4D4C0);">xcb_randr_id</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>query_x  </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> xcb_get_extension_data</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>wm</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">connection</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> &amp;</span><span style="color: light-dark(#7D4242, #D4D4C0);">xcb_xinerama_id</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">if</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span>query_xr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>present</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span>    using_xrandr </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> true</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>    randr_base </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#7D4242, #D4D4C0);"> query_xr</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">first_event</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#3C6362, #A2BD90);">    xcb_randr_select_input</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span style="color: light-dark(#7D4242, #D4D4C0);">wm</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">connection</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span style="color: light-dark(#7D4242, #D4D4C0);"> wm</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">root_window</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span></span>
<span class="giallo-l"><span>                           XCB_RANDR_NOTIFY_MASK_SCREEN_CHANGE</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span></code></pre>
<p>If RandR is present, I also subscribe to screen change events, which is how hotplug works later. For RandR, the setup iterates outputs, skips disconnected ones, and creates a <code>monitor_t</code> for each connected output with a valid CRTC, where each monitor gets its rectangle from the CRTC geometry.</p>
<h2 id="desktops-per-monitor">desktops per monitor</h2>
<p>Each monitor gets its own set of desktops:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span>curr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>n_of_desktops </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> conf.virtual_desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>curr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>desktops </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> malloc</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span style="color: light-dark(#4B4B48, #CB8B8B);">sizeof</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span style="color: light-dark(#855959, #A6BCAD);">desktop_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span> curr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">n_of_desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">for</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#784367, #D4B399);">int</span><span> j </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> 0</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span> j </span><span style="color: light-dark(#4B4B48, #CB8B8B);">&lt;</span><span> curr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>n_of_desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span> j</span><span style="color: light-dark(#4B4B48, #CB8B8B);">++</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    desktop_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>d </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> init_desktop</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#7D4242, #D4D4C0);">    d</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">id</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> =</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#784367, #D4B399);">uint16_t</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span>j</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#7D4242, #D4D4C0);">    d</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">is_focused</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> =</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span>j </span><span style="color: light-dark(#4B4B48, #CB8B8B);">==</span><span style="color: light-dark(#784367, #CA9D7D);"> 0</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#7D4242, #D4D4C0);">    curr</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>j</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> =</span><span> d</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span>
<span class="giallo-l"><span>curr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>desk </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> curr</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span style="color: light-dark(#784367, #CA9D7D);">0</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span></code></pre>
<p>So if you have 2 monitors and 5 desktops configured, you actually have 10 desktops total, 5 on each monitor. Desktop 1 on monitor 1 is completely independent from desktop 1 on monitor 2.</p>
<p>Desktop switching only affects the current monitor:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">for</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#784367, #D4B399);">int</span><span> i </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> 0</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span> i </span><span style="color: light-dark(#4B4B48, #CB8B8B);">&lt;</span><span> curr_monitor</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>n_of_desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> ++</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#7D4242, #D4D4C0);">    curr_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">is_focused</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> =</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#7D4242, #D4D4C0);">curr_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">id</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> ==</span><span> id</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">    if</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#7D4242, #D4D4C0);">curr_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">id</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> ==</span><span> id</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#7D4242, #D4D4C0);">        curr_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desk</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> =</span><span style="color: light-dark(#7D4242, #D4D4C0);"> curr_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">    }</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span></code></pre><h2 id="which-monitor-is-current">which monitor is current</h2>
<p>This is pointer-driven, meaning the monitor under the mouse pointer is the current one. When a new window appears, I check where the pointer is and update <code>curr_monitor</code>:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">if</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span>multi_monitors</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    monitor_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>mm </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> get_focused_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">    if</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span>mm </span><span style="color: light-dark(#4B4B48, #CB8B8B);">&amp;&amp;</span><span> mm </span><span style="color: light-dark(#4B4B48, #CB8B8B);">!=</span><span> curr_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span>        curr_monitor </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> mm</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">    }</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span></code></pre>
<p><code>get_focused_monitor()</code> queries pointer position and finds which monitor rectangle contains it. Same thing happens on enter notify and motion notify events: when the pointer crosses into a different monitor, <code>curr_monitor</code> updates.</p>
<h2 id="geometry-and-layout">geometry and layout</h2>
<p>Each monitor has a usable area which is the physical rectangle minus strut padding (for bars like polybar):</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">int32_t</span><span> x </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>rectangle.x </span><span style="color: light-dark(#4B4B48, #CB8B8B);">+</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>padding.left</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">int32_t</span><span> y </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>rectangle.y </span><span style="color: light-dark(#4B4B48, #CB8B8B);">+</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>padding.top</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">int32_t</span><span> w </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#784367, #D4B399);">int32_t</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span>m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>rectangle.width </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>padding.left </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>padding.right</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">int32_t</span><span> h </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#784367, #D4B399);">int32_t</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span>m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>rectangle.height </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>padding.top </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span> m</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>padding.bottom</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span></code></pre>
<p>Layouts compute within this usable area, and gaps and borders are subtracted:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">rectangle_t</span><span> usable </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> get_usable_area</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>m</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>r</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>x </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> usable.x </span><span style="color: light-dark(#4B4B48, #CB8B8B);">+</span><span> conf.window_gap</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>r</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>y </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> usable.y </span><span style="color: light-dark(#4B4B48, #CB8B8B);">+</span><span> conf.window_gap</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>r</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>width  </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> usable.width  </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#784367, #CA9D7D);"> 2</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span> conf.window_gap </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#784367, #CA9D7D);"> 2</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span> conf.border_width</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span>r</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>height </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> usable.height </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#784367, #CA9D7D);"> 2</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span> conf.window_gap </span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#784367, #CA9D7D);"> 2</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span> conf.border_width</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span></code></pre>
<p>Fullscreen is also monitor-aware: a fullscreen window fills its monitor, not the whole X11 screen:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">monitor_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>m </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#3C6362, #A2BD90);"> get_monitor_by_window</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>win</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">rectangle_t</span><span> r </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span> m </span><span style="color: light-dark(#4B4B48, #CB8B8B);">?</span><span style="color: light-dark(#7D4242, #D4D4C0);"> m</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">rectangle</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> :</span><span> curr_monitor</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>rectangle</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#3C6362, #A2BD90);">resize_window</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>win</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span> r.width</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span> r.height</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#3C6362, #A2BD90);">move_window</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>win</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span> r.x</span><span style="color: light-dark(#4B4B48, #7F7C77);">,</span><span> r.y</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span></code></pre><h2 id="cycling-monitors">cycling monitors</h2>
<p>Keyboard shortcut to move focus between monitors:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">if</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span>m </span><span style="color: light-dark(#4B4B48, #CB8B8B);">&amp;&amp;</span><span> m </span><span style="color: light-dark(#4B4B48, #CB8B8B);">!=</span><span> curr</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#3C6362, #A2BD90);">    move_mouse_to_monitor</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span>m</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span></code></pre>
<p>I warp the pointer to the target monitor, and the enter/motion handlers then update <code>curr_monitor</code>. I don't directly assign <code>curr_monitor</code> here because I want the pointer position to stay in sync with which monitor is active.</p>
<h2 id="hotplug">hotplug</h2>
<p>RandR sends <code>XCB_RANDR_SCREEN_CHANGE_NOTIFY</code> when monitors connect or disconnect:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">if</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span>using_xrandr </span><span style="color: light-dark(#4B4B48, #CB8B8B);">&amp;&amp;</span></span>
<span class="giallo-l"><span>    event_type </span><span style="color: light-dark(#4B4B48, #CB8B8B);">==</span><span> randr_base </span><span style="color: light-dark(#4B4B48, #CB8B8B);">+</span><span> XCB_RANDR_SCREEN_CHANGE_NOTIFY</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#3C6362, #A2BD90);">    handle_monitor_changes</span><span style="color: light-dark(#4B4B48, #7F7C77);">(</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">    return</span><span style="color: light-dark(#784367, #CA9D7D);"> 0</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span></code></pre>
<p><code>handle_monitor_changes()</code> detects three cases: a new monitor connected (create monitor node, initialize desktops, add to linked list), a monitor geometry changed (update the rectangle), and a monitor disconnected, which is the tricky one.</p>
<p>When a monitor disconnects, its windows need to go somewhere, so I merge them into another monitor:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#4B4B48, #D4D4C0); background-color: light-dark(#D7D5C3, #212121);"><code data-lang="c"><span class="giallo-l"><span style="color: light-dark(#784367, #D4B399);">for</span><span style="color: light-dark(#4B4B48, #7F7C77);"> (</span><span style="color: light-dark(#784367, #D4B399);">int</span><span> i </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#784367, #CA9D7D);"> 0</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span> i </span><span style="color: light-dark(#4B4B48, #CB8B8B);">&lt;</span><span> om</span><span style="color: light-dark(#4B4B48, #CB8B8B);">-</span><span style="color: light-dark(#4B4B48, #CB8B8B);">&gt;</span><span>n_of_desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span><span> i</span><span style="color: light-dark(#4B4B48, #CB8B8B);">++</span><span style="color: light-dark(#4B4B48, #7F7C77);">)</span><span style="color: light-dark(#4B4B48, #7F7C77);"> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    desktop_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>od </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#7D4242, #D4D4C0);"> om</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#855959, #A6BCAD);">    desktop_t</span><span style="color: light-dark(#4B4B48, #CB8B8B);"> *</span><span>nd </span><span style="color: light-dark(#4B4B48, #CB8B8B);">=</span><span style="color: light-dark(#7D4242, #D4D4C0);"> nm</span><span style="color: light-dark(#4B4B48, #7F7C77);">-&gt;</span><span style="color: light-dark(#7D4242, #D4D4C0);">desktops</span><span style="color: light-dark(#4B4B48, #7F7C77);">[</span><span>i</span><span style="color: light-dark(#4B4B48, #7F7C77);">]</span><span style="color: light-dark(#4B4B48, #7F7C77);">;</span></span>
<span class="giallo-l"><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">    //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> traverse old desktop tree</span></span>
<span class="giallo-l"><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">    //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> for each window: unlink from old, transfer to new</span></span>
<span class="giallo-l"><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;">    //</span><span style="color: light-dark(#7A7D7A, #7F7C77);font-style: italic;"> rearrange target tree</span></span>
<span class="giallo-l"><span style="color: light-dark(#4B4B48, #7F7C77);">}</span></span></code></pre>
<p>Windows from desktop 1 of the old monitor go to desktop 1 of the remaining monitor, and then I destroy the old monitor node.</p>
<h2 id="notes">notes</h2>
<ul>
<li>RandR is the modern way, Xinerama is legacy but still needed for some setups</li>
<li>The coordinate space is global: monitor at x=0 is leftmost, next monitor starts at x=1920 (or whatever)</li>
<li>Strut padding comes from EWMH, bars like polybar set <code>_NET_WM_STRUT_PARTIAL</code> and the WM respects it</li>
<li>Primary monitor is queried from RandR, and if not set, I default to head of the list</li>
</ul>
  
</article>
</main>
    <hr class="site-sep bottom-sep" />
    <footer class="s">
        
    </footer>
    

    <script>
        document.querySelectorAll("article img[srcset]").forEach((i) => {
            if (i.closest("a")) return;
            i.style.cursor = "pointer";
            i.onclick = () => {
                let d = document.createElement("div"),
                    s = i.srcset.split(",").pop().trim().split(" ")[0];
                d.className = "lb";
                d.innerHTML = '<img src="' + s + '">';
                document.body.style.overflow = "hidden";
                d.onclick = () => {
                    d.remove();
                    document.body.style.overflow = "";
                };
                document.body.appendChild(d);
            };
        });
    </script>
    
<button id="scroll-to-top" aria-label="Scroll to top" title="Scroll to top">â†‘</button>
<script>
    (function() {
        var btn = document.getElementById("scroll-to-top");
        if (btn) {
            window.addEventListener("scroll", function() {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                    btn.classList.add("show");
                } else {
                    btn.classList.remove("show");
                }
            });
            btn.addEventListener("click", function() {
                window.scrollTo({top: 0, behavior: 'smooth'});
            });
        }
    })();
</script>
</body>

</html>